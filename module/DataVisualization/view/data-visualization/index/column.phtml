<?php

    $this->headScript()->appendFile($this->basePath() . '/js/controller/columnController.js');

?>
<h1>
    Conversion
    <a href="<?= $this->url('visualization/conversion', array('conversion_id' => $conversion->getId())); ?>">
        <?= $this->escapeHtml($conversion->getName()); ?>
    </a>
</h1>

<h2>
    Table
    <?= $this->escapeHtml($this->column->getTableDef()->getName()); ?>
</h2>

<h2>
    Column
    <?= $this->escapeHtml($this->column->getName()); ?>
</h2>

<div class="container">
    <div class="col-md-2">
        Data Type: <?= $this->escapeHtml($this->column->getDataType()); ?>
    </div>
    <div class="col-md-2">
        Length: <?= $this->escapeHtml($this->column->getLength()); ?>
    </div>
    <div class="col-md-2">
        Default Value: <?= $this->escapeHtml($this->column->getDefaultValue()); ?>
    </div>
    <div class="col-md-2">
        Is Nullable: <?= ($this->column->getIsNullable()) ? 'YES': 'NO'; ?>
    </div>
    <div class="col-md-2">
        Extra: <?= $this->escapeHtml($this->column->getExtra()); ?>
    </div>
</div>

<div ng-controller="columnController" ng-init="columnModel.init('<?= $this->url('database-api.rest.doctrine.data-point'); ?>', <?= $conversion->getId(); ?>, <?= $column->getId(); ?>)">
<div cg-busy="columnPromise"></div>

<table class="table table-striped table-hover">
    <caption>
        <ul class="pagination center-block">
            <li ng-repeat="(name, link) in dataPoint._links">
                <a href="#" ng-click="columnModel.load(link.href)">{{ name }}</a>
            </li>
        </ul>
    </caption>
    <thead>
        <tr>
            <th>
                Primary Key string
            </th>
            <th>
                Old Value
            </th>
            <th>
                New Value
            </th>
            <th>
                Flagged
            </th>
            <th>
                Approved
            </th>
        </tr>
    </thead>
    <tbody>

        <tr ng-repeat="dataPoint in dataPoint._embedded.data_point" ng-class-odd="'odd'" ng-class-even="'even'">
            <td>
                {{ dataPoint.primaryKey }}
            </td>
            <td>
                {{ dataPoint.oldValue }}
            </td>
            <td>
                <span onbeforesave="columnModel.update(dataPoint, {'newValue': $data})" editable-textarea="dataPoint.newValue" e-rows="8" e-cols="120">{{ dataPoint.newValue }}</span>
            </td>
            <td>
                <a class="btn" ng-class="(dataPoint.flagged) ? 'btn-danger': 'btn-default'"
                    ng-click="
                        columnModel.update(dataPoint, {'flagged': !dataPoint.flagged, 'approved': false});
                    ">
                    Flagged
                </a>
            </td>
            <td>
                <a class="btn btn-default" ng-class="(dataPoint.approved) ? 'btn-success': 'btn-default'"
                    ng-click="
                        columnModel.update(dataPoint, {'approved': !dataPoint.approved, 'flagged': false});
                    ">
                    Approved
                </a>
            </td>
        </tr>

    </tbody>
</table>

</div>